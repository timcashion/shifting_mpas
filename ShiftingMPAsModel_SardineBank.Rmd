---
title: "Shifting Seas, Shifting Boundaries: Dynamic Marine Protected Area designs for a Changing Climate"
author: "Tim Cashion^1^ *, Tu Nguyen^2^, Talya ten Brink^3^ ^, Anne Mook^4^ ^, Juliano Palacios-Abrantes^5^ ^, Sarah M. Roberts^6^ ^"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  bookdown::html_document2
  #bookdown::word_document2
bibliography: MyCollection.bib
always_allow_html: yes
biblio-style: "apalike"
---

## Affilitations 
1. Fisheries Economics Research Unit, Institute for the Oceans and Fisheries, University of British Columbia, Vancouver, V6T 1Z4, Canada
2. Department of Applied Economics, Oregon State University, Corvallis, OR 97330 USA
3. Department of Marine Affairs, University of Rhode Island
4. Department of International Studies, American University of Sharjah, Sharjah, United Arab Emirates
5. Changing Oceans Research Unit, Institute for the Oceans and Fisheries, University of British Columbia, Vancouver, V6T 1Z4, Canada
6. Marine Geospatial Ecology Lab, Nicholas School of the Environment and Earth Sciences, Duke University, Durham, NC 27708, USA

*Corresponding author. t.cashion@oceans.ubc.ca
^ These authors contributed equally. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning= F, message=F)

ipak <- function(pkg){
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if (length(new.pkg)) 
    install.packages(new.pkg, dependencies = TRUE)
  sapply(pkg, require, character.only = TRUE)
}
packages <- c(
  "tidyverse", #data manipulation and plotting
  "wesanderson", #Awesome colour schemes
  "rmarkdown", #rmarkdown document formatting and functions
  "knitr" #for printing tables with 'kable' 
)
ipak(packages)
source("./R/end_of_century_average.R")
source("./R/spatial_maps_segment_plots.R")
```

```{r data, echo=FALSE, warning=FALSE, message=FALSE}
#For data cleaning files, see R script of 'OutputDataCleaning.R' 
mpa_labels <- tibble(design = c("MPA_Horiz_Static", 
                                "MPA_Square_Static", 
                                "MPA_Square_Shifting", 
                                "MPA_Vert_Static", 
                                "MPA_Network_Static", 
                                "MPA_Network_Shifting", 
                                "NoMPA"),
                     mpa_label = c("Horizontal Static", 
                                "Square Static", 
                                "Square Shifting", 
                                "Vertical Static", 
                                "Network Static", 
                                "Network Shifting", 
                                "No MPA"))

average_data <- read_csv("/nfs/mpasandclimatechange-data/Data/AnchovyBay/DataOutputs/AnnualAverageData_tidy.csv")
average_data <- average_data %>% 
  rename(year=Year) %>% 
  mutate(year=year-1) %>% 
  filter(scenario==10)
mpa_data <- read_csv("/nfs/mpasandclimatechange-data/Data/AnchovyBay/DataOutputs/MPAData_tidy.csv")
mpa_data <- mpa_data %>%
  mutate(scenario = gsub(scenario, pattern="MPA Scenario ", replacement = "")) %>% 
  mutate(scenario = gsub(scenario, pattern=" Percent", replacement = "")) %>% 
  mutate(scenario = as.numeric(scenario)) %>% 
  filter(scenario == 10)

spatial_data <- read_csv("/nfs/mpasandclimatechange-data/Data/AnchovyBay/DataOutputs/SpatialData_tidy_10.csv")
price_data <- read_csv("/nfs/mpasandclimatechange-data/Data/AnchovyBay/DataOutputs/PriceData_tidy.csv")

price_data$elasticity[price_data$elasticity>=2] <- 1.99

port_data <- read_csv("/nfs/mpasandclimatechange-data/Data/AnchovyBay/DataOutputs/PortData_tidy.csv")

average_fleet_data <- average_data %>% 
  filter(grepl(group, pattern="\\|"))

#Price elasticity:
orig_catch <- average_fleet_data %>% 
  filter(year==1 & RCP=="RCP2.6" & design=="NoMPA" & scenario=="10") %>% 
  select(group, value) %>% 
  rename(orig_catch = value)
average_fleet_data <- average_fleet_data %>% 
  left_join(price_data) %>% 
  left_join(orig_catch) %>% 
  rename(catch=value) %>% 
  mutate(PercChange = ((catch-orig_catch)/orig_catch))

average_fleet_data$PercChange[average_fleet_data$PercChange>=0.35] <- 0.35
average_fleet_data$PercChange[average_fleet_data$PercChange<=-0.35] <- -0.35


average_fleet_data <- average_fleet_data %>% 
  mutate(CurrentPrice = Price*(((-1*elasticity)*PercChange)+1))  %>% 
  mutate(value=CurrentPrice*catch)

elasticity_adjusted_prices <- average_fleet_data %>% 
  select(year, fg, design, RCP, CurrentPrice)

spatial_catch_data <- spatial_data %>% 
  filter(type=="Catch") %>% 
  left_join(elasticity_adjusted_prices) %>%
  rename(catch=value) %>% 
  mutate(value=CurrentPrice*catch)

mpa_legend <- tibble(mpa=c(0,1,2), MPA=c("Outside", "Inside", "Adjacent"))
#Be careful with plotting the spatial data. To achieve the originally designed visual version in plots, the row_num (i.e. the y-axis) needs to be reversed as the original layout goes from 1 at the top to 20 at the bottom. Plots by default have higher values at the top and lower values at the bottom (i.e., the opposite of our grid layout). 

```

```{r plot-design}

zissou_continuous <- wes_palette(name = "Zissou1", n=100, type = c("continuous"))
zissou_discrete_3 <- wes_palette(name = "Zissou1")[c(1,3,5)]
theme_set(theme_classic())
zissou_blue <- wes_palette("Zissou1")[1]
zissou_red <- wes_palette("Zissou1")[5]


```


# Abstract 
Marine protected areas (MPAs) are valuable tools for marine conservation that limit human impacts on marine systems and protect valuable species or habitats. However, as species distributions shift due to warming, acidification, and oxygen depletion from climate change, the areas originally designated under MPAs may bear little resemblance to their past state. Different approaches have been suggested for coping with species on the move in conservation. Here, we test the effectiveness of different MPA designs, including dynamic, network, and different directional orientations, on protecting shifting species under climate change through ecosystem modeling in a theoretical ecosystem. Our findings suggest that dynamic marine protected areas may benefit some species, and these benefits can inform the design or adaptation of MPAs worldwide. In addition, we find that it is important to design MPAs with specific goals and to account for the effects of released fishing pressure and species interaction in MPA design. 

Keywords: climate change, Ecospace, Ecopath, ecosystem modeling, marine protected areas, marine spatial planning

# Introduction

Marine protected areas (MPAs) are among the most popular types of marine spatial planning to protect species and habitats from harmful human activities [@song_institutional_2017]. MPA designs vary in shape and size, with some incorporating dynamic shifting boundaries, while others are connected networks of MPAs. Positive social-ecological impacts of MPAs within their boundaries include increasing fish biomass, density, and size, maintaining species diversity, supporting food production, and providing aesthetic, recreational, and spiritual values [@lester_biological_2009; @lester_evaluating_2013]. Some of these benefits have been shown to also occur outside of the MPAs boundaries, with the spillover of adult fish biomass occurring in waters up to two kilometers away, subsequently increasing fish yield in surrounding areas [@halpern_spillover_2009]. However, not all of these benefits are shared equitably and often lead to positive outcomes for some users and negative outcomes for others, necessitating a balance of trade-offs between different users. 

There is vast evidence that marine species are shifting their distributions due to climate change around the world [@poloczanska_responses_2016].  Moreover, modeling exercises suggest such shifts will continue [@cheung_projecting_2009], even with strong mitigation of greenhouse gases such as under the Paris Agreement [@cheung_large_2016]. Given that most MPAs are static in locations and boundaries, MPAs may lose their function to protect specific habitats or species on the move under climate change [@bruno_climate_2018], which undermines the future benefits of MPAs and their ability to meet conservation goals [@fredston-hermann_biogeographic_2018]. Thus, management needs to explicitly consider climate change to protect species with shifting distributions [@davies_large_2017].

This paper responds to gaps in the MPA literature by examining the biological and economic effects of varied MPA designs on protecting shifting species distributions under alternative future climate change scenarios [@fredston-hermann_biogeographic_2018; @gruss_consequences_2011; @kleisner_effects_2016]. We focus on two main MPA designs that have been identified as potential solutions to the conservation of species on the move: dynamic and network MPAs [@song_institutional_2017]. We employ Ecopath with Ecosim and Ecospace, a modeling software used to study the impacts of MPA management strategies that incorporates ecological and social-economic criteria [@beattie_model_2008]. We test whether MPAs continue to have benefits under climate change (under 2 degrees and 4 degrees of warming), or whether the negative effects of climate change can be stemmed by certain MPA designs (Figure 1). We measured three different outcomes (biomass, catches and revenues) of the MPA scenarios for 11 functional groups (see Supplemental Material for functional groups).

![Figure 1. Conceptual figure of methods used for this study. Warming scenario visual obtained from IPCC, 2013.](./methodsfigure.png)

# Results

We measured the outcomes of the MPA scenarios in three different ways: biomass, catches, and revenues. 

## Aggregate results 
Our results suggest that there is a significant difference in biomass in three MPA design scenarios - Vertical Static, Square Shifting, and Network Static vs. no-MPA scenarios (Figure \@ref(fig:ecosystem-wide-results)), however, the magnitude of the difference in biomass is minimal (<5% difference in biomass) (Supplemental Table SX). Catches are slightly higher under all MPA scenarios than under the no MPA scenario, indicating that spillover compensates for the loss in catch in areas closed to fishing inside MPA boundaries. This finding demonstrates that our parameterized model predicts spillover catches and benefits to fisheries. No single MPA design consistently significantly outperforms the others in terms of both biomass and catch under both RCPs. Even with higher catches, revenue is significantly lower under all MPA scenarios (Figure \@ref(fig:ecosystem-wide-results)) due to a combination of price elasticity and lower-value species being caught. Overall, there is strong variation of catches by species under different MPA designs, especially in the Network designs; however, the changes in catches between MPA designs at the edges of MPAs are minimal when aggregated across groups (Figure \@ref(fig:catch-groups-biomass-catch)).


```{r ecosystem-wide-results, eval=T, fig.cap="Aggregate results at the end of the 21^st^ century for all scenarios under RCP 8.5. All scenarios are significantly different in terms of catch and revenue from the no MPA scenario. Significance levels: \\*\\*\\*: p-value < 0.001; \\*\\*: p-value < 0.01; \\*: p-value < 0.05."}
baseline_decade <- average_data %>% 
  group_by(RCP, design, year, type) %>% 
  summarize(value_aggregate = sum(value)) %>% 
  filter(year <=9) %>% 
  group_by(RCP, design, type) %>% 
  summarize(average_2000s = mean(value_aggregate),
            stdev_2000s = sd(value_aggregate)) %>%
  mutate(se_2000s = stdev_2000s/sqrt(10))

end_of_century_decade <- average_data %>% 
  group_by(RCP, design, year, type) %>% 
  summarize(value_aggregate = sum(value)) %>% 
  filter(year >=90 & year <99) %>% 
  group_by(RCP, design, type) %>% 
  summarize(average_2090s = mean(value_aggregate),
            stdev_2090s = sd(value_aggregate)) %>%
  mutate(se_2090s = stdev_2090s/sqrt(9))


summary_table_revenue1 <- average_fleet_data %>% 
  group_by(RCP, design, year, type) %>% 
  summarize(value_aggregate = sum(value)) %>% 
  filter(year <= 9) %>% 
  group_by(RCP, design, type) %>% 
  summarize(average_2000s = mean(value_aggregate),
            stdev_2000s = sd(value_aggregate)) %>%
  mutate(se_2000s = stdev_2000s/sqrt(10))

summary_table_revenue2 <- average_fleet_data %>% 
  group_by(RCP, design, year, type) %>% 
  summarize(value_aggregate = sum(value)) %>% 
  filter(year >=90 & year <99) %>% 
  group_by(RCP, design, type) %>% 
  summarize(average_2090s = mean(value_aggregate),
            stdev_2090s = sd(value_aggregate)) %>%
  mutate(se_2090s = stdev_2090s/sqrt(9))



summary_table_temp_baseline <- baseline_decade %>% gather(key= variable, value=value, -RCP, -type, -design)
summary_table_temp_end_of_century <- end_of_century_decade %>% gather(key= variable, value=value, -RCP, -type, -design)
summary_table_temp <- rbind(summary_table_temp_baseline, summary_table_temp_end_of_century)
summary_table_temp$type <- gsub(summary_table_temp$type, pattern=".*_", replacement="")
summary_table_temp$year <- gsub(summary_table_temp$variable, pattern=".*_", replacement="")
summary_table_temp$variable <- gsub(summary_table_temp$variable, pattern="_.*", replacement="")
summary_table_temp$aggregate <- paste(summary_table_temp$RCP, summary_table_temp$design, summary_table_temp$year, sep="/")
summary_table_temp$label <- paste(summary_table_temp$design, summary_table_temp$year, sep=" ")

spread <- summary_table_temp %>%
  filter(variable != "se")  %>%
  spread(key=variable, value=value)

summary_table_biomass <- spread %>% filter(type=="Biomass")
summary_table_catch <- spread %>% filter(type=="Catch")
summary_table_effort <- spread %>% filter(type=="Effort")


summary_table_revenue2$year <- "2090s"
summary_table_revenue2$type <- "Revenue"

colnames(summary_table_revenue2) <- gsub(colnames(summary_table_revenue2), pattern="_2090s", replacement="")
agg_plot_data <- bind_rows(spread, summary_table_revenue2)


test_data <- average_data %>% 
  group_by(RCP, design, type, year) %>% 
  summarize(value_aggregate = sum(value)) %>% 
  
  filter(year >=90 & year <99 & RCP=="RCP8.5")
test_data$design <- fct_relevel(test_data$design, "NoMPA", after=0)
linmod_biomass <- lm(value_aggregate ~ design, 
                     data=test_data %>% filter(type=="Average_Biomass"))
linmod_catch <- lm(value_aggregate ~ design, 
                   data=test_data %>% filter(type=="Average_Catch"))
# summary(linmod_biomass)
# summary(linmod_catch)

test_data_revenue <- average_fleet_data %>% 
  filter(year >=90 & year <99 & RCP=="RCP8.5") %>% 
  group_by(RCP, design, year, type) %>% 
  summarize(value_aggregate = sum(value))
test_data_revenue$design <- fct_relevel(test_data_revenue$design, "NoMPA", after=0)

linmod_revenue <- lm(value_aggregate ~ design, 
                     data=test_data_revenue)
#summary(linmod_revenue)

mpa_labels$mpa_label <- fct_relevel(mpa_labels$mpa_label, "No MPA", after=6)
label_df <- tibble(type=c(rep("Biomass", 7), rep("Catch", 7), rep("Revenue", 7)), 
                   mpa_label = rep(factor(sort(mpa_labels$mpa_label)),3),
                   average = c(rep(60, 7), rep(4, 7), rep(12, 7)),
                   label_sig= c("", "", "**", "***", "", "***", "",
                                rep("***", 6), "",
                                rep("***", 6), ""))

output_table_biomass <- summary_table_biomass %>%
  filter(year=="2090s") %>%
  mutate(value = paste(round(average, 1), " (", round(stdev,2), ")", sep="")) %>%
  select(-c( year,aggregate, label, average, stdev)) %>%
  spread(design, value=value) 

output_table_catch <- summary_table_catch %>%
  filter(year=="2090s") %>%
  mutate(value = paste(round(average, 1), " (", round(stdev,2), ")", sep="")) %>%
  select(-c( year,aggregate, label, average, stdev)) %>%
  spread(design, value=value) 

output_table_effort <- summary_table_effort %>%
  filter(year=="2090s") %>%
  mutate(value = paste(round(average, 1), " (", round(stdev,2), ")", sep="")) %>%
  select(-c(year,aggregate, label, average, stdev)) %>%
  spread(design, value=value) 

agg_plot_data %>% 
  filter(year=="2090s" & RCP=="RCP8.5") %>% 
  left_join(mpa_labels) %>% 
  ggplot(aes(x=mpa_label, y=average, fill=type)) +
  geom_col() +
  geom_errorbar(aes(x=mpa_label, ymin=average-(stdev*1.96), ymax=average+(stdev*1.96))) + 
  coord_flip() + 
  xlab("MPA design") + 
  ylab(expression(paste("Tonnes / km"^2, "                          Tonnes / km"^2, "                             $ / km"^2))) +
  #ylab(expression("Tonnes km"^2 , "Tonnes / km"^2 , "$ / km"^2)) +
  theme(legend.position = "None") + 
  facet_wrap(~type, scales="free_x") + 
  geom_text(data=label_df, aes(x=mpa_label, y=average, label=label_sig)) + 
  NULL
ggsave("./VisualOutputs/AggregateResultsBarPlotRCP85_EndOfCentury.png", dpi=600)



```

```{r mpa-spatial-prep}
mpa_spatial <- left_join(spatial_data, mpa_data) 
mpa_spatial$mpa[which(mpa_spatial$design=="NoMPA")] <- 0
x <- mpa_spatial[is.na(mpa_spatial$mpa),] 
colors <- c(NA, "red", "blue")
mpa_spatial <- mpa_spatial %>% 
  left_join(mpa_legend)
mpa_spatial$MPA <- as.factor(mpa_spatial$MPA)
mpa_spatial$MPA <- fct_relevel(mpa_spatial$MPA, "Outside", after=0)
mpa_spatial$MPA <- fct_relevel(mpa_spatial$MPA, "Inside", after=1)

```



```{r mpa-annotate}

#Create manual borders for each MPA design
horiz_static <- tibble(design="MPA_Horiz_Static", mx1=3, mx2=16, my1=3, my2=5, ax1=1, ax2=2, ay1=1, ay2=2)
network_static1 <- tibble(design="MPA_Network_Static", mx1=8, mx2=13, my1=3, my2=4, ax1=0, ax2=2, ay1=0, ay2=2)
network_static2 <- tibble(design="MPA_Network_Static", mx1=8, mx2=13, my1=6, my2=7, ax1=0, ax2=2, ay1=0, ay2=2)
network_static3 <- tibble(design="MPA_Network_Static", mx1=8, mx2=13, my1=9, my2=11, ax1=0, ax2=2, ay1=0, ay2=2)
network_shifting1 <- tibble(design="MPA_Network_Shifting", mx1=8, mx2=13, my1=2, my2=3, ax1=0, ax2=2, ay1=0, ay2=2)
network_shifting2 <- tibble(design="MPA_Network_Shifting", mx1=8, mx2=13, my1=5, my2=6, ax1=0, ax2=2, ay1=0, ay2=2)
network_shifting3 <- tibble(design="MPA_Network_Shifting", mx1=8, mx2=13, my1=8, my2=10, ax1=0, ax2=2, ay1=0, ay2=2)
square_static <- tibble(design="MPA_Square_Static", mx1=8, mx2=13, my1=3, my2=9, ax1=0, ax2=2, ay1=0, ay2=2)
square_shifting <- tibble(design="MPA_Square_Shifting", mx1=8, mx2=13, my1=2, my2=8, ax1=0, ax2=2, ay1=0, ay2=2)
vert_static <- tibble(design="MPA_Vert_Static", mx1=9, mx2=11, my1=2, my2=15, ax1=0, ax2=2, ay1=0, ay2=2)
mpa_annotation_df <- bind_rows(horiz_static, network_static1, network_shifting1, network_static2, network_shifting2, network_static3, network_shifting3, square_static, square_shifting, vert_static)

#Then need to expand to touch the 'edges' of the MPA rather than start at the center of the cell. 
#Subtract 0.5 from min coords and add 0.5 to max coords. 
mpa_annotation_df$mx1 <- mpa_annotation_df$mx1 - 0.5
mpa_annotation_df$mx2 <- mpa_annotation_df$mx2 + 0.5
mpa_annotation_df$my1 <- mpa_annotation_df$my1 - 0.5
mpa_annotation_df$my2 <- mpa_annotation_df$my2 + 0.5

#I reverse the orientation on the map so I need to reverse the y coordinates here too:
mpa_annotation_df$my1 <- 21  - mpa_annotation_df$my1
mpa_annotation_df$my2 <- 21  - mpa_annotation_df$my2

mpa_annotation_df$ax1 <- mpa_annotation_df$mx1 - 1
mpa_annotation_df$ax2 <- mpa_annotation_df$mx2 + 1
mpa_annotation_df$ay1 <- mpa_annotation_df$my1 + 1
mpa_annotation_df$ay2 <- mpa_annotation_df$my2 - 1

#Make sure the border goes around all of the MPA (important for the network MPA designs)
mpa_annotation_df <- mpa_annotation_df %>% 
  group_by(design) %>% 
  mutate(ax1 = min(ax1),
         ay1 = max(ay1),
         ax2 = max(ax2),
         ay2 = min(ay2)) %>% 
  ungroup() 


nompa <- tibble(design="NoMPA", mx1=NA, mx2=NA, my1=NA, my2=NA, ax1=NA, ax2=NA, ay1=NA, ay2=NA)
mpa_annotation_df <- bind_rows(mpa_annotation_df, nompa) %>% 
  left_join(mpa_labels, by= "design") %>% 
  select(-design) %>% 
  rename(design=mpa_label)


```


```{r catch-groups-biomass-catch, fig.cap="Biomass and catch of fished functional groups at the end of the century (Years 90-100)", dpi=600, fig.width=20, fig.height=6}

mpa_spatial <- mpa_spatial %>% 
  left_join(mpa_labels) %>% 
  select(-design) %>% 
  rename(design=mpa_label)

catch_fgs <- c("Anchovy", "Shrimp", "Mackerel ad", "Whiting", "Cod", "Seals")
mpa_spatial_biomass_fisheries <- end_of_century_average(df=mpa_spatial, groups=catch_fgs)
mpa_spatial_catch_fisheries <- end_of_century_average(df=mpa_spatial, groups=catch_fgs)

max_value <- max(mpa_spatial_biomass_fisheries %>% filter(type=="Biomass") %>% pull(value))
min_value <- min(mpa_spatial_biomass_fisheries %>% filter(type=="Biomass") %>% pull(value)) 
min_value <- floor(min_value)
if (ceiling(max_value)!=1){
  max_value <- ceiling(max_value)
}


mpa_spatial_biomass_fisheries$design <- fct_relevel(mpa_spatial_biomass_fisheries$design, "No MPA", after=0)
mpa_designs <- unique(mpa_spatial_biomass_fisheries$design)
for (design in mpa_designs){
  p <- spatial_maps_segment_plots(df=mpa_spatial_biomass_fisheries, MPA_design=design, type_measure="Biomass", RCP_scenario="RCP8.5")
  #ggsave(paste0("./VisualOutputs/ChangeInBiomassFisheriesGroups", design, ".png"), plot=p, dpi=300) #Optional save each plot as we go. 
  plot_name <- paste0(design, "Biomass")
  assign(plot_name, p)
}

p <- p +
  theme(legend.position = "right") +
  labs(fill=expression("Biomass t/km"^2))
biomass_segment_legend <- cowplot::get_legend(p)

combined_biomass <- cowplot::plot_grid(`No MPABiomass`, `Horizontal StaticBiomass`, `Vertical StaticBiomass`, `Square StaticBiomass`, `Square ShiftingBiomass`, `Network StaticBiomass`, `Network ShiftingBiomass`, biomass_segment_legend,  align="h", nrow=1)
#print(combined_biomass)
ggsave("./VisualOutputs/ChangeinBiomassFisheriesGroupsCombined.png", plot=combined_biomass, dpi=1200, height = 4, width=20)


max_value <- max(mpa_spatial_catch_fisheries %>% filter(type=="Catch") %>% pull(value))
min_value <- min(mpa_spatial_catch_fisheries %>% filter(type=="Catch") %>% pull(value)) 
min_value <- floor(min_value)
if (ceiling(max_value)!=1){
  max_value <- ceiling(max_value)
}
for (design in mpa_designs){
  p <- spatial_maps_segment_plots(df=mpa_spatial_catch_fisheries, MPA_design=design, type_measure="Catch", RCP_scenario="RCP8.5")
  #ggsave(paste0("./VisualOutputs/ChangeInCatchFisheriesGroups", design, ".png"), plot=p, dpi=300)
  plot_name <- paste0(design, "Catch")
  assign(plot_name, p)
}

p <- p +
  theme(legend.position = "right") +
  labs(fill=expression("Catch t/km"^2))
catch_segment_legend <- cowplot::get_legend(p)


combined_catch <- cowplot::plot_grid(`No MPACatch`, `Horizontal StaticCatch`, `Vertical StaticCatch`, `Square StaticCatch`, `Square ShiftingCatch`, `Network StaticCatch`, `Network ShiftingCatch`, catch_segment_legend,
                                   align="h", nrow=1)
#print(combined_catch)
ggsave("./VisualOutputs/ChangeinCatchFisheriesGroupsCombined.png", plot=combined_catch, dpi=1200, height = 4, width=20)


combined_both <- cowplot::plot_grid(`No MPABiomass`, `Horizontal StaticBiomass`, `Vertical StaticBiomass`, `Square StaticBiomass`, `Square ShiftingBiomass`, `Network StaticBiomass`, `Network ShiftingBiomass`, biomass_segment_legend,
                                   `No MPACatch`, `Horizontal StaticCatch`, `Vertical StaticCatch`, `Square StaticCatch`, `Square ShiftingCatch`, `Network StaticCatch`, `Network ShiftingCatch`, catch_segment_legend,
                                   align="h", nrow=2)
print(combined_both)
ggsave("./VisualOutputs/ChangeinBiomassCatchFisheriesGroupsCombined.png", dpi=1200, height = 8, width=20)


```


## Species-specific results
There are winners and losers for different species and fisheries. The spillover effect of increased catches adjacent to MPAs is observable for those species that thrive within the MPA depending on the MPA design (e.g., for whiting under all MPA designs, Figure SX). This effect of increasing biomass within the MPA is mediated by the predator-prey interactions that may be affected by whether some species are primarily protected from fisheries (e.g., shrimp is negatively affected within the MPAs by the protection of their predator, whiting). Anchovy and whiting are the two groups that benefit the most compared to the No MPA scenario under all MPA scenarios (Figure \@ref(fig:bar-chart-biomass)). The non-network scenarios (the static vertical, horizontal, and square and the dynamic square scenarios) appear to generate more extreme positive outcomes for anchovy, whiting and whales and larger negative outcomes for mackerel (juvenile and adult) and shrimp. This strong negative effect on mackerel is consistent across MPA scenarios. While they may be protected from fishing within the MPA, mackerel also appears to be affected by an increase in their predators (whales), which drive them to very low biomass levels relative to the No MPA scenario. 

```{r bar-chart-biomass, fig.cap="Percent change in biomass of select functional groups compared to No MPA scenario at the end of the 21^st^ century. Error bars represent 95% confidence intervals of the mean percent change."}

excluded_fgs <- c("Zooplankton", "Benthos", "Phytoplankton", "Detritus")

decade1 <- seq(0,9,1)
decade2 <- seq(45,54,1)
decade3 <- seq(90,99,1)

average_data <- average_data %>% 
  mutate(TimePeriod = if_else(year %in% decade1, "Today", 
                              if_else(year %in% decade2, "Mid-Century", 
                                      if_else(year %in% decade3, "End of Century", ""))))

average_data$TimePeriod <- fct_relevel(average_data$TimePeriod, "Today", "Mid-Century", "End of Century")

biomass_fg_data <- average_data %>%
  filter(TimePeriod != "") %>% 
  filter(!group %in% excluded_fgs) %>% 
  filter(RCP=="RCP8.5") %>% 
  group_by(group, TimePeriod, type, design, RCP) %>%
  summarize(stdev = sd(value, na.rm=TRUE),
            value=mean(value)) 

nompa_average <- biomass_fg_data %>% 
  ungroup() %>% 
  filter(design=="NoMPA")  %>% 
  rename(baseline=value,
         baseline_stdev = stdev) %>% 
  select(-c(design))

sd_num <- 1.96
biomass_fg_data <- biomass_fg_data %>% 
  ungroup() %>% 
  filter(design!="NoMPA") %>% 
  filter(TimePeriod == "End of Century") %>% 
  left_join(nompa_average) %>% 
  mutate(upper_bound = value + (sd_num*stdev),
         lower_bound = value - (sd_num*stdev)) %>% 
  mutate(perc_change = ((value-baseline)/baseline)*100,
         upper_bound = ((upper_bound-baseline)/baseline)*100,
         lower_bound = ((lower_bound-baseline)/baseline)*100
         )

biomass_fg_data$group <- as.character(biomass_fg_data$group) 
biomass_fg_data$group <- gsub(biomass_fg_data$group, pattern=" ad", replacement=" adult")
biomass_fg_data$group <- gsub(biomass_fg_data$group, pattern=" juv", replacement=" juvenile")
biomass_fg_data$group <- as.factor(biomass_fg_data$group)
biomass_fg_data$group <- fct_relevel(biomass_fg_data$group, c("Mackerel adult", "Anchovy",  "Mackerel juvenile", "Whales",  "Shrimp", "Seals", "Cod", "Whiting"), after=0)

biomass <- biomass_fg_data %>% 
  filter(type=="Average_Biomass") %>% 
  left_join(mpa_labels) %>% 
  ggplot(aes(x=mpa_label, y=perc_change, fill=perc_change)) +
  geom_col() +
  geom_errorbar(aes(x=mpa_label, ymin=lower_bound, ymax=upper_bound)) + 
  coord_flip() +
  xlab("MPA design") + 
  ylab("Percent change in biomass") + 
  facet_wrap(~group, ncol=2, scales="free_x") + 
  scale_fill_gradientn(colors=rev(zissou_continuous)) + 
  labs(fill="Percent change") + 
  NULL
biomass
ggsave("./VisualOutputs/Change in biomass by scenario under RCP8.5_AlternativeFormat.png", dpi=300, width=8.5, height=12, units="in")

```
 

## Fishery results
Our results suggest that catches were higher under all MPA scenarios and fisheries revenues were lower under all MPAs compared to the No MPA scenario. This is likely because catches of high-value species are lower (e.g., shrimp), while low-value species (e.g., anchovy and whiting) are higher. Species that have increased biomass under the MPA scenarios also have higher catches, and vice versa (Figure SXX-1.4). The increase in biomass is followed by an increase in catches with the same fishing effort thus leading to higher catch per unit effort of these fleets. Thus, the 'foragers' fleet for anchovy and the trawlers for whiting see their catches increase by between 15 and 30% depending on the scenario. In contrast, the mackerel fleet experiences much lower catches, not only because of the area closed to fishing, but also due to the lowered mackerel populations. These changes in the catch profiles under MPA scenarios lead to an aggregate loss in fisheries revenues, even though there are higher total catches. 

Only the anchovy fleet experiences economic benefits under the MPA scenarios (Figure \@ref(fig:bar-chart-revenue-by-fleet)). The remaining fleets experience no change from the No MPA scenario (cod) or declines in revenue (all others). While the network MPA scenarios minimize losses for these other scenarios, they also are the worst performing for the anchovy fleets. This is likely due to a trade-off where the low biomass (and thus catches) of the other species are releasing the anchovy from their predators. 

MPAs lead to an aggregate loss in revenue under climate change, when compared to a no-MPA scenario due to a reduction in fishing area. However, some designs perform better than others (Figure \@ref(fig:ecosystem-wide-results)). By the end of the century under RCP8.5, the dynamic network and the static network designs perform the best in terms of revenue and experience the smallest loss relative to the No MPA scenario. This is likely due to the high number of exploitable areas on the edges of these MPAs that allow fishers to capitalize on the spillover effects of MPAs. 


```{r bar-chart-revenue-by-fleet, fig.cap="Percent change in revenue of each fishing fleet compared to No MPA scenario at the end of the 21^st^ century. Error bars represent 95% confidence intervals of the mean percent change."}

design_chosen <- c("MPA_Vert_Static", "MPA_Network_Static", "MPA_Square_Shifting")
excluded_fgs <- c("Zooplankton", "Benthos", "Phytoplankton", "Detritus")

average_fleet_data <- average_fleet_data %>% 
  mutate(TimePeriod = if_else(year %in% decade1, "Today", 
                              if_else(year %in% decade2, "Mid-Century", 
                                      if_else(year %in% decade3, "End of Century", ""))))

average_fleet_data$TimePeriod <- fct_relevel(average_fleet_data$TimePeriod, "Today", "Mid-Century", "End of Century")

revenue_fleet_data <- average_fleet_data %>%
  filter(TimePeriod != "") %>% 
  filter(RCP=="RCP8.5") %>% 
  group_by(group, TimePeriod, design, RCP) %>%
  summarize(stdev = sd(value),
            value=mean(value))

nompa_average <- revenue_fleet_data %>% 
  ungroup() %>% 
  filter(design=="NoMPA")  %>% 
  rename(baseline_stdev = stdev,
         baseline=value) %>% 
  select(-design)

revenue_fleet_data <- revenue_fleet_data %>% ungroup() %>% 
  filter(design!="NoMPA") %>% 
  left_join(nompa_average) %>% 
  mutate(upper_bound = value + (sd_num*stdev),
         lower_bound = value - (sd_num*stdev)) %>% 
  mutate(perc_change = ((value-baseline)/baseline)*100,
         upper_bound = ((upper_bound-baseline)/baseline)*100,
         lower_bound = ((lower_bound-baseline)/baseline)*100
         )

revenue_fleet_data$group <- as.character(revenue_fleet_data$group)
revenue_fleet_data$group[which(revenue_fleet_data$group=="Seiners | Mackerel ad")] <- "Seiners | Mackerel adult"
revenue_fleet_data$group <- as.factor(revenue_fleet_data$group)
revenue_fleet_data$group <- fct_relevel(revenue_fleet_data$group, c("Seiners | Mackerel adult", "Foragers | Anchovy",  "Shrimpers | Shrimp", "Sealers | Seals",  "Trawlers | Whiting","Trawlers | Cod"), after=0)

revenue <- revenue_fleet_data %>% 
  filter(TimePeriod=="End of Century") %>% 
  left_join(mpa_labels) %>% 
  ggplot(aes(x=mpa_label, y=perc_change, fill=perc_change)) +
  geom_col() +
  geom_errorbar(aes(x=mpa_label, ymin=lower_bound, ymax=upper_bound)) + 
  coord_flip() +
  xlab("MPA design") + 
  ylab("Percent change in revenue") + 
  facet_wrap(~group, ncol=2, scales="free_x") + 
  scale_fill_gradientn(colors=rev(zissou_continuous)) + 
  labs(fill="Percent change") + 
  NULL
revenue
ggsave("./VisualOutputs/Change in revenue by scenario and fleet under RCP8.5.png", dpi=300, width=8.5, height=11, units="in")




```

# Discussion   

The potential benefits of dynamic MPAs are likely complicated by the ecological reality of predator-prey interactions and shifting fishing effort. Therefore, the potential benefits of MPAs vary among species [@lester_biological_2009]. While MPAs are often introduced to protect the marine ecosystem, they appear, in this analysis, to modify a previously fished ecosystem which can exacerbate predator-prey interactions to the point of increasing some populations and dramatically reducing others. Therefore, the idea of MPAs restoring ecosystems to some unfished historical state is complicated by ecological reality. Consequently, MPA design necessitates economic and ecological tradeoffs that modify the ecosystem functioning and thus translate into effects in the human dimension [@rees_thematic_2013].  While dynamic MPAs may have ecological benefits, they may be difficult in practice near coastal areas where a wide-variety of human activities occur and many people rely on the coastal environment for their livelihoods. 

The Vertical MPA and Square Shifting MPA scenario may mitigate the negative impact of climate change on biomass by protecting species as they migrate to cooler waters because the Vertical MPA covers a larger temperature gradient than the other scenarios, and the Square Shifting MPA moves towards a colder temperature gradient. This may partially address current concerns expressed by Bruno et al. [-@bruno_climate_2018]of species thermal thresholds being exceeded in current tropical MPAs. However, this may not be true in all cases, where species migration to cooler waters may not be poleward [@burrows_ocean_2019]. The Network Static MPA increased aggregate biomass, yet it negatively impacted some species more than other MPA designs due to fisheries being able to exploit the spillover effect. In line with this finding, the Network MPAs were the best performing designs for fishery revenues over time. 

We saw an increase in biomass in some MPA scenarios, suggesting that, even under climate change, MPAs could provide benefits regionally. However, our model shows that there is no silver bullet for maintaining ecological functions and the fisheries that depend on them under climate change. Various MPA designs performed relatively similar to each other in terms of aggregate catch and revenue in comparison to the No MPA scenario, suggesting that MPAs could be beneficial regardless of the design. In terms of fisheries revenue, our MPA designs did not outperform no-MPA scenarios under climate change. This finding reinforces our understanding that trade-offs between species protection and fisheries are often needed.

The results of our study confirm the importance of analyzing predator-prey interactions, and the need for managers to consider these interactions before implementing an MPA. Ecosystem based management can be particularly helpful instead of single-species based management as the former accounts for species interactions. Fished ecosystems are highly altered by the introduction of an MPA that modifies predator-prey interactions. To apply these findings, it is important to understand that the establishment of an MPA disrupts a current ecosystem that includes fishing pressure and that the ecosystems and their populations will be modified by these spatial restrictions of fishing pressure. These dynamics can be examined by modeling how food webs will respond if heavily fished species or an apex predator is released from fishing pressure [@mitchell_quantifying_2018]. Thus, it is important to design MPAs with specific goals in mind, whether it is the protection of a single species, certain species, or overall protection of the ecosystem. 

Our results suggest that there is no one optimal solution path in the face of climate change because it depends on predator-prey dynamics, but different MPA designs could potentially bring about regional benefits in terms of biomass and catch. As our study shows, MPA managers must anticipate the effects of released fishing pressure and species interactions on the goals of their MPA. In the face of a changing climate, research that models the potential trade-offs of MPAs for sustainable fisheries management remains relevant on local and global scales. 

# Author statement
TC conducted the modeling in EwE.

All authors contributed to the original study design and idea.  
All authors contributed to writing and editing the manuscript, and approved the final manuscript.  

# Data availability
All data and models are available in the supplementary material and all code used for analysis is available on https://gitlab.sesync.org/mpasandclimatechange. 

# Acknowledgements
This work was supported by the National Socio-Environmental Synthesis Center (SESYNC) under funding received from the National Science Foundation DBI-1639145.
# References

